---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

[![Travis-CI Build Status](https://travis-ci.org/jjchern/laus.svg?branch=master)](https://travis-ci.org/jjchern/laus)
[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/jjchern/laus?branch=master&svg=true)](https://ci.appveyor.com/project/jjchern/laus)

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README/README-fig-",
  cache.path = "README/README-cache-"
)
```

```{r, echo = FALSE, warning=FALSE, message=FALSE}
library(knitr)

# Borrowed from https://raw.githubusercontent.com/dgrtwo/gganimate/master/README.Rmd
# GitHub cannot show .mp4s or other animation formats.
# I therefore hacked together a GIF animation hook for knitr.

library(animation)
ani.options(autobrowse = FALSE, interval = 1)

opts_knit$set(animation.fun = function(x, options, format = "gif") {
  x = c(knitr:::sans_ext(x), knitr:::file_ext(x))
  fig.num = options$fig.num
  format = sub("^[.]", "", format)
  fig.fname = paste0(sub(paste0(fig.num, "$"), "*", x[1]), 
                     ".", x[2])
  mov.fname = paste0(sub(paste0(fig.num, "$"), "", x[1]), ".", 
                     format)

  # order correctly
  figs <- Sys.glob(fig.fname)
  figs <- figs[order(as.numeric(stringr::str_match(figs, paste0("(\\d+)\\.", x[2]))[, 2]))]

  animation::im.convert(figs, output = mov.fname)
  
  sprintf("![%s](%s)", options$label, paste0(opts_knit$get("base.url"), mov.fname))
})

opts_chunk$set(cache = TRUE, message = FALSE, warning = FALSE, fig.show = "animate")
```

# About

An R data package contains Local Area Unemployment Statistics (LAUS) from U.S. Bureau of Labor Statistics (BLS). So far it contains the following four series:

- `state_year`: 
    - State-level employment status of the civilian noninstitutional population, annual average series (1976-2015)
- `state_month_sa`: 
    - State-level employment status of the civilian noninstitutional population, seasonaly adjusted monthly series (1976-2015)
- `state_month_nsa`: 
    - State-level employment status of the civilian noninstitutional population, not seasonaly adjusted monthly series (1976-2015)
- `county_year`: 
    - County-level employment status of the civilian noninstitutional population, annual average series (1990-2015)

## Relevant packages

- [`rUnemploymentData`](https://github.com/trulia/rUnemploymentData/)

# Installation

```R
# install.package("devtools")
devtools::install_github("jjchern/laus@v0.0.1")
```

# Usage

## List all series

```{r}
data(package = "laus")$results[,3]
```

## List all variable names and variable labels for `state_year`

```{r}
names(laus::state_year)

# devtools::install_github("larmarange/labelled")
labelled::var_label(laus::state_year)
```

## Show the data frame

```{r}
library(tidyverse)
laus::state_year
laus::county_year
```

## Plot a thematic map with the unemployment data

```{r unem-2015-map}
# Combine state map data with unemployment rate
# devtools::install_github("jjchern/usmapdata")
usmapdata::state %>% 
  inner_join(laus::state_year, by = c("id" = "fips")) -> unem

# Plot a Map

library(gganimate)

ggplot() +
  geom_map(data = unem, map = unem,
           aes(x = long, y = lat, map_id = id, fill = unem_rate, frame = year),
           colour = alpha("white", 0.5), size=0.2) +
  coord_map("albers", lat0 = 30, lat1 = 40) +
  viridis::scale_fill_viridis(option = "B") +
  ggtitle("US Unemplyment Rates (%) by State in") +
  ggthemes::theme_map() +
  theme(legend.position = c(.85, .3),
        legend.title=element_blank(), 
        plot.title = element_text(hjust = 0.5)) -> g

gganimate(g)
```

```{r}
usmapdata::county %>% 
        inner_join(laus::county_year, by = c("id" = "fips")) -> unem_county

ggplot() +
  geom_map(data = unem_county, map = unem_county,
           aes(x = long, y = lat, map_id = id, fill = unemployment_rate, frame = year),
           colour = alpha("white", 0.1), size=0.2) +
  geom_map(data = usmapdata::state, map = usmapdata::state,
           aes(x = long, y = lat, map_id = id),
           colour = alpha("white", 0.75), fill = "NA") +        
  coord_map("albers", lat0 = 30, lat1 = 40) +
  viridis::scale_fill_viridis(option = "B") +
  ggtitle("US Unemplyment Rates (%) by County in") +
  ggthemes::theme_map() +
  theme(legend.position = c(.85, .3),
        legend.title=element_blank(), 
        plot.title = element_text(hjust = 0.5)) -> c

gganimate(c)
```


